# 第二章 Makefile总述
## 2.1 Makefile的内容
标准Makefile包含5样东西：显式规则、隐含规则、变量的定义、指示符和注释。

1. 显式规则：略；
2. 隐含规则：它是make根据此类目标文件的命名（典型的是文件名的后缀）而自动推导出来的规则。 make根据目标文件的名字，自动产生目标的依赖文件并使用默认的命令来对目标进行更新。
3. 变量定义：略；
4. 指示符：指示符指明在 make 程序读取 makefile 文件过程中所要执行的一个动作。（比如include、条件判断）
5. 注释：略。

## 2.2 Makefile文件命名
make程序查找非指定文件名顺序：GNUmakefile -> makefile -> Makefile

-f 选项可以指定makefile文件，make就不会查找上面三个文件了

## 2.3 包含其他Makefile文件

包含其他makefile文件方法就是使用指示符“include”。



include的应用场合:

1.  有多个不同的程序，由不同目录下的几个独立的Makefile来描述其创建或者更新规则。它
们需要使用一组通用的变量定义或者模式规则。通用的做法是将这些共同使用的变量或者模式规则定义在一个文件中，在需要使用的Makefile中使用指示符“include”来包含此文件。

2. 当根据源文件自动产生依赖文件时；我们可以将自动产生的依赖关系保存在另外一个文件中，主Makefile使用指示符“include”包含这些文件。这样的做法比直接在主Makefile中追加依赖文件的方法要明智的多。其它版本的make已经使用这种方式来处理。

如果include指定的文件不是绝对路径，那么make会以以下顺序查找文件： “当前目录” -> “/usr/gnu/include” -> “/usr/local/include” -> “/urs/include”，如果都没找到就先弹出一个警告，但是不会马上退出，继续处理makefile的内容，当读取完所有makefile文件之后，试图使用规则来创建刚刚include没找到的文件，如果创建失败，那么就会提示致命错误如下：

	Makefile:错误的行数：未找到文件名：提示信息（ No such file or directory）
	Make： *** No rule to make target ‘<filename>’. Stop

## 2.10 总结

make 的执行过程如下：

1. 依次读取变量“MAKEFILES”定义的 makefile 文件列表
2. 读取工作目录下的 makefile 文件（根据命名的查找序“GNUmakefile”，“makefile”，“Makefile”，首先找到那个就读取那个）
3. 依次读取工作目录 makefile 文件中使用指示符“include”包含的文件
4. 查找重建所有已读取的 makefile 文件的规则（如果存在一个目标是当前读取的某一个makefile 文件，则执行此规则重建此 makefile 文件，完成以后从第一步开始重新执行）
5. 初始化变量值并展开那些需要立即展开的变量和函数并根据预设条件确定执行分支
6. 根据“终极目标”以及其他目标的依赖关系建立依赖关系链表
7. 执行除“终极目标”以外的所有的目标的规则（规则中如果依赖文件中任一个文件的时间戳比目标文件新，则使用规则所定义的命令重建目标文件）
8. 执行“终极目标”所在的规则